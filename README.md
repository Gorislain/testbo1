# Wildberries Product Bot

Этот проект представляет собой бота, разработанного для тестового задания, который взаимодействует с API сайта Wildberries для получения информации о продуктах. Проект включает FastAPI-приложение, Telegram-бота и интеграцию с базой данных PostgreSQL. 

## Структура проекта

Основная логика проекта находится в папке `app`, которая включает следующие компоненты:

- **api** — Реализует API для взаимодействия с продуктами и подписками.
- **bot** — Содержит код для Telegram-бота, использующего библиотеку `aiogram`.
- **core** — Вспомогательные модули, включая планировщик задач.
- **models** — Описание структуры базы данных.
- **main.py** — Основной файл запуска приложения.

## Дополнительные файлы

- **Alembic** — Используется для миграции базы данных.
- **Dockerfile** — Содержит инструкции для создания Docker-образа.
- **docker-compose.yml** — Описывает настройку и запуск нескольких контейнеров, а также связи между ними.
- **heroku.yml** — Описание команды для контейнеризации при развертывании приложения на Heroku.
- **Procfile** — Настройки для развертывания приложения.
- **requirements.txt** — Список библиотек и их версий, которые устанавливаются при развертывании и контейнеризации.
- **runtime.txt** — Указывает используемую версию Python.

## Реализованные функции

### Эндпоинт для работы с продуктами

1. **GET /api/v1/subscribe/{artikul}**:
   - Этот эндпоинт был недостаточно ясен в тестовом задании, поэтому я реализовал обновление всей базы данных с учетом запрашиваемых товаров. В задании не было конкретики, требуется ли автоматический метод для всех товаров или персонализированный для каждого пользователя. Я выбрал автоматический способ обновления всех данных.

### Основные файлы и их назначение

- **products.py**: Реализует эндпоинт FastAPI для добавления продуктов в базу данных. Запрашивает информацию о продукте с сайта Wildberries по артикулу и сохраняет или обновляет данные в базе данных.
  
- **bot.py**: Реализует Telegram-бота с помощью библиотеки `aiogram`. Бот позволяет пользователям получать данные о товарах с Wildberries, отправляя артикул товара, и включает планировщик для запуска задач в фоновом режиме.
  
- **database.py**: Настроивает подключение к базе данных PostgreSQL через SQLAlchemy для асинхронных операций. Создает сессию для работы с базой данных и предоставляет функцию для получения сессии при запросах.
  
- **scheduler.py**: Интегрирует планировщик задач с FastAPI-приложением. Планировщик периодически выполняет асинхронные задачи для сохранения данных и предоставляет эндпоинты для управления задачами (добавление, удаление, настройка интервала).

- **tasks.py**: Содержит асинхронные функции для получения данных о продуктах с Wildberries по артикулу и их сохранения или обновления в базе данных, используя SQLAlchemy для работы с базой данных и HTTPX для выполнения асинхронных запросов.

- **main.py**: Запускает FastAPI-приложение, инициализирует базу данных при старте (создавая все необходимые таблицы), запускает Telegram-бота в фоновом потоке и подключает роутеры для работы с продуктами через API.
