Представляю бота для тестового задания.
Основная логика находится в папке app, разделенной на api, bot, core, models с файлом запуска main.py.
Alembic нужен для миграции базы данных.
Dockerfile содержит набор инструкций для создания Docker-образа.
В docker-compose.yml описывается как должны быть запущены несколько контейнеров, их настройки и связи между собой.
В heroku.yml описана команда для запуска контейнеризации при развертывании приложения на heroku.
В Procfile приведены настройки при развертывании.
В requirements.txt описаны используемые библиотеки и их версии, при развертывании и контейнеризации они устанавливаются автоматически.
В runtime.txt напсиана используемая версия Python.
эндпоинт GET /api/v1/subscribe/{artikul} был недостаточно мною понят, поэтому я реализовал обновление всей базы данных, относительно запрашиваемых товаров. В задании нужна конкретика, либо это автоматический метод, сравбатываемый на все, либо в котором необходимо конкретизировать для каждого пользователя отдельно. Самым оптимальным посчитал сделать автоматический.
products.py реализует эндпоинт FastAPI для добавления продукта в базу данных, запрашивая информацию о продукте с сайта Wildberries по артикулу и сохраняет или обновляет данные в БД.
bot.py реализует Telegram-бота с помощью библиотеки aiogram, который позволяет пользователям получать данные о товарах с сайта Wildberries, отправляя артикул, а также включает планировщик для запуска задач в фоне.
database.py настроивает подключение к базе данных PostgreSQL через SQLAlchemy для асинхронных операций, создавая сессию для работы с базой данных и обеспечивая функцию для получения сессии при запросах.
scheduler.py представляет собой FastAPI-приложение с интеграцией планировщика задач, который периодически выполняет асинхронную задачу по сохранению данных, и предоставляет эндпоинты для управления задачами (добавление, удаление, настройка интервала).
tasks.py содержит асинхронные функции для получения данных о продуктах с Wildberries по артикулу и их сохранения или обновления в базе данных, с использованием SQLAlchemy для работы с базой и HTTPX для выполнения асинхронных запросов.
main.py запускает FastAPI приложение, инициализирует базу данных при старте (создавая все необходимые таблицы), запускает бота в фоновом потоке и подключает роутеры для работы с продуктами через API.
